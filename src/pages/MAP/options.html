<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>LGE</title>
    <link rel="stylesheet" href="/lg5-common/css/reset.min.css" />
    <link rel="stylesheet" href="/lg5-common/css/pages/MAP/MAP.min.css" />
    <script src="/lg5-common/js/libs/jquery-2.2.4.min.js"></script>
    <!-- <script src="/lg5-common/js/common-ui.js"></script> -->
    <script>
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;

        var beforeFocusEle = "";
        var optModal = {
            open: function(id, role, txt, confirm, cancel){
                //var $id = $(id);
                //$id.fadeIn(200);

                var valId = id;
                if(id == null || id == "" || id == undefined){
                    varId = "lyr-modal";
                }
                var valRole = role;
                if(role == null || role == "" || role == undefined){
                    valRole = "alert";
                }
                var valConfirm = confirm;
                if(confirm == null || confirm == "" || confirm == undefined){
                    valConfirm = "확인";
                }
                var html = '<div class="lyr-modal" id="'+valId+'">';
                    html += '   <div class="lyr-modal-dt">';
                    html += '        <div class="lyr-modal-dc">';
                    html += '            <div class="lyr-modal-inner" role="'+valRole+'" aria-modal="true" aria-hidden="true" tabindex="0">';
                    html += '                <div>';
                    html +=                     txt;
                    html += '                </div>';
                    html += '                <div class="btn-box">';
                        if(cancel != null && cancel != "" && cancel != undefined){
                            html += '                    <button type="button" class="btn-modal-cancel"><span>'+cancel+'</span></button>';
                            html += '                    <button type="button" class="btn-modal-confirm"><span>'+valConfirm+'</span></button>';
                        }else{
                            html += '                    <button type="button" class="btn-modal-confirm"><span>'+valConfirm+'</span></button>';
                        }
                    html += '                </div>';
                    html += '            </div>';
                    html += '        </div>';
                    html += '    </div>';
                    html += '</div>';

                $body = $("body");
                $body.append(html);
                $("#"+id).fadeIn(200, function(){
                    //접근성
                    $(this).find(".lyr-modal-inner").attr("aria-hidden", false).focus();
                    $(".main-panel, .sub-panel").attr("aria-hidden", true);
                });
                modalControl();
            },
            close: function(){
                $(document).find(".lyr-modal").fadeOut(200, function(){
                    //접근성
                    $(".main-panel, .sub-panel").attr("aria-hidden", false);
                    $(beforeFocusEle).focus();
                    beforeFocusEle = "";
                    $(this).remove();
                });
            }
        }
        var cnt = 15;
        var toastMessage = {
            init: function(txt, type){
                if(!type){
                    type= "";
                }
                var id = "toast"+cnt;
                var $type = type;
                var $body = $("body");
                var html = '<div class="toast-message" id="'+id+'">';
                    html += '    <div>';
                    html += '        <div class="txt-message ' + $type + '">' + txt + '</div>';
                    html += '        <button type="button" class="btn-toast-close"><span>닫기</span></button>';
                    html += '    </div>';
                    html += '</div>';

                $body.append(html);
                this.open("#"+id);
            },
            open: function(id){
                cnt++;
                var $id = $(id);

                $id.css("z-index", cnt).animate({'bottom':'50px'}, 200);
                setTimeout(function(){
                    toastMessage.close($id);
                }, 3000);
                $id.find(".btn-toast-close").on({
                    click : function(){
                        toastMessage.close($id);
                    }
                });
            },
            close: function(id){
                var $id = $(id);
                //$id.removeClass("show").remove();
                $id.css("z-index", cnt).animate({'bottom':'-60px'}, 200, function(){
                    $(this).remove();
                });
            }
        }

        var modalControl = function(){
            //Modal Close
            $(".lyr-modal .btn-modal-cancel").on({
                click : function(){
                    var $id = $(this).closest(".lyr-modal").attr("id");

                    switch($id){
                        case "modalTimeset" :

                        break;
                        case "modalShopInfo" :

                        break;
                        default:

                        break;
                    }
                    optModal.close();
                }
            });
            $(".lyr-modal .btn-modal-confirm").on({
                click : function(){
                    var $id = $(this).closest(".lyr-modal").attr("id");

                    switch($id){
                        case "modalLocationInfo1" :
                            $("#locInfo").prop("checked", true).trigger("change");
                        break;
                        case "modalLocationInfo2" :
                            $("#locInfo").prop("checked", false).trigger("change");
                        break;
                        case "modalPushAlarm" :
                            $("#pushAlarm").prop("checked", false).trigger("change");
                            $(".ctrl-area").removeClass("active");
                            if($("#badgeAlarm").prop("checked")){
                                $("#badgeAlarm").trigger("click");
                            }
                            $("#badgeAlarm").attr("disabled", true).closest(".opt-switch").parent().addClass("disabled");
                            if($("#timeSet").prop("checked")){
                                $("#timeSet").trigger("click");
                            }

                            //접근성
                            $("#pushAlarm").attr("aria-expanded", false);
                        break;
                        case "modalAlarmAgree" :
                            $("#pushAlarm").prop("checked", true).trigger("change");
                            $(".ctrl-area").addClass("active");
                            $("#badgeAlarm").attr("disabled", false).closest(".opt-switch").parent().removeClass("disabled");
                        break;
                        case "modalTimeset" :

                        break;
                        case "modalShopInfo" :

                        break;
                        default:
                        break;
                    }
                    optModal.close();
                }
            });
        }

        $(document).ready(function(){
            //로그아웃
            $("#btn-opt-logout").on({
                click : function(){
                    //optModal.open("#modalLogin");
                    beforeFocusEle = "#btn-opt-logout";
                    optModal.open("modalLogin", "alertdialog", "<p>로그아웃 하시겠습니까?</p>", "확인", "취소");
                }
            });
            //위치정보 이용동의
            $("#locInfo").on({
                click : function(){
                    beforeFocusEle = "#locInfo";
                    var checked = $(this).prop("checked");
                    if(checked){
                        //optModal.open("#modalLocationInfo1");
                        optModal.open("modalLocationInfo1", "alertdialog", "<p>사용자 위치정보를 수집하는데 <br>동의하시겠습니까?</p>", "확인", "취소");
                    }else{
                        //optModal.open("#modalLocationInfo2");
                        optModal.open("modalLocationInfo2", "alertdialog", "<p>위치정보 수집에 대한 <br>동의를 철회하시겠습니까?</p>", "확인", "취소");
                    }
                    return false;
                }
            });
            //푸시 알림 받기
            $("#pushAlarm").on({
                click : function(){
                    beforeFocusEle = "#pushAlarm";
                    var checked = $(this).prop("checked");
                    if(checked){
                        //optModal.open("#modalAlarmAgree");
                        optModal.open("modalAlarmAgree", "alert", "<p>알림 수신을 동의하셨습니다.</p>", "확인");
                        //접근성
                        $(this).attr("aria-expanded", true);
                    }else{
                        //optModal.open("#modalPushAlarm");
                        optModal.open("modalPushAlarm", "alertdialog", "<p>푸시 알림을 해제하시는 경우 <br><strong>서비스 이벤트 혜택 알림을</strong> <br>받을 수 없게 됩니다.<br>알림을 해제 하시겠습니까?</p>", "확인", "취소");
                        return false;
                    }
                }
            });
 
            //시간 설정
            $("#timeSet").on({
                click : function(){
                    var checked = $(this).prop("checked");
                    if(checked){
                        $(".details input").attr("disabled",false);
                        $(".time-setting").addClass("on");
                        $(this).closest(".opt-switch").siblings("p").addClass("on");
                    }else{
                        $(".details input").attr("disabled", true);
                        $(".time-setting").removeClass("on");
                        $(this).closest(".opt-switch").siblings("p").removeClass("on");
                    }
                }
            });
            var oldStartValue = "";
            var oldEndValue = "";
            var date = new Date();
            var fullYear = date.getFullYear();
            var month = (date.getMonth() + 1) < 10 ? "0" + (date.getMonth() + 1) : (date.getMonth() + 1);
            var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
            var today = month + "/" + day + "/" + fullYear + " ";

            //iOS는 blur
            //Android는 변경 시 change, 변경 안했을 시는 click
            $(".time-setting input").on({
                click : function(){
                    var value = $(this).val();
                    $(this).closest("div").find("[class*=rst-time]").text(value);
                    oldStartValue = $(this).closest(".inner").find("div").eq(0).find("input").val();
                    oldEndValue = $(this).closest(".inner").find("div").eq(1).find("input").val();
                },
                focusin : function(){
                    $(this).closest("div").find("[class*=rst-time]").addClass("focus");
                },
                focusout: function(){
                    $(this).closest("div").find("[class*=rst-time]").removeClass("focus");
                },
                change : function(){
                    var value = $(this).val();
                    $(this).closest("div").find("[class*=rst-time]").text(value);

                    //oldStartValue = $(this).closest(".inner").find("div").eq(0).find("input").val();
                    //oldEndValue = $(this).closest(".inner").find("div").eq(1).find("input").val();

                    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        //console.log("iphone");
                    }else{
                        //$(this).trigger("blur");
                        $(this).closest("div").attr("tabindex", 0).focus();
                    }
                },
                blur: function(){
                    //console.log("iphone");
                    var startDate = $(".t-start");
                    var endDate = $(".t-end");
                    var startDateVal = startDate.val();
                    var endDateVal = endDate.val();

                    var idx = $(this).closest("div").index();

                    if(Date.parse(today + startDateVal) == Date.parse(today + endDateVal)){
                        //optModal.open("#modalTimeset");
                        optModal.open("modalTimeset", "alert", "<p>시작 시간과 종료 시간을 <br>같은 시간으로 설정할 수 없습니다.</p>", "확인");
                        $("#modalTimeset .btn-modal-confirm").on({
                            click : function(){
                                $(".time-setting .inner div").eq(idx).find("[class*=rst-time]").text(idx == 0 ? oldStartValue : oldEndValue);
                                $(".time-setting .inner div").eq(idx).find("input").val(idx == 0 ? oldStartValue : oldEndValue);
                                optModal.close();
                                //$(".time-setting .inner div").eq(idx).find("[class*=rst-time]").focus();
                            }
                        });
                        return false;
                    }else{
                        toastMessage.init("에티켓 시간이 설정되었습니다.");
                    }

                    /*
                    $.ajax({
                        method : "GET",
                        url : "./options.html",
                        cache: false,
                        success: function(data, status, j){
                            console.log("success");
                            console.log(j.readyState);
                        },
                        error: function(j, status, err){
                            console.log("error");
                        }
                    }).done(function(){
                        var startDate = $(".t-start");
                        var endDate = $(".t-end");
                        var startDateVal = startDate.val();
                        var endDateVal = endDate.val();

                        var idx = $(this).closest("div").index();

                        if(Date.parse(today + startDateVal) == Date.parse(today + endDateVal)){
                            //optModal.open("#modalTimeset");
                            optModal.open("modalTimeset", "alert", "<p>시작 시간과 종료 시간을 <br>같은 시간으로 설정할 수 없습니다.</p>", "확인");
                            $("#modalTimeset .btn-modal-confirm").on({
                                click : function(){
                                    $(".time-setting .inner div").eq(idx).find("[class*=rst-time]").text(idx == 0 ? oldStartValue : oldEndValue);
                                    $(".time-setting .inner div").eq(idx).find("input").val(idx == 0 ? oldStartValue : oldEndValue);
                                    optModal.close();
                                    //$(".time-setting .inner div").eq(idx).find("[class*=rst-time]").focus();
                                }
                            });
                            return false;
                        }else{
                            toastMessage.init("에티켓 시간이 설정되었습니다.");
                        }
                    });
                    */
                }
            });

            //마케팅 푸시 알림 받기
            $("#mktPushAlarm").on({
                click : function(){
                    var checked = $(this).prop("checked");
                    if(checked){
                        toastMessage.init("2021년01월14일 12시 <br>알림 허용 처리가 완료되었습니다.", "type2");
                    }else{
                        toastMessage.init("2021년01월14일 12시 <br>알림 거부 처리가 완료되었습니다.", "type2");
                    }
                }
            });

            //옵션창 열기
            $("#btn-opt-open").on({
                click : function(){
                    $(".lyr-opt-panel, .main-panel").stop().animate({"left":"0"}, 250, function(){
                        //접근성
                        $(".main-panel").focus();
                        $(".main-panel").attr("aria-hidden", false);
                    });
                }
            });
            //옵션창 닫기
            $(".btn-opt-close").on({
                click : function(){
                    $(".lyr-opt-panel, .main-panel").stop().animate({"left":"100%"}, 250, function(){
                        //접근성
                        $(".main-panel").attr("aria-hidden", true).siblings("div");
                    });
                }
            });
            //알림설정 창 열기
            $("#btn-alarm-set").on({
                click : function(){
                    $(".main-panel").stop().animate({"left":"-100%"}, 250);
                    $(".sub-panel.alarm-setting").stop().animate({"left":"0"}, 250, function(){
                        //접근성
                        $(this).focus();
                        $(this).attr("aria-hidden", false).siblings("div").attr("aria-hidden", true);
                    });
                }
            });
            //알림설정 창 닫기
            $(".alarm-setting .btn-opt-prev").on({
                click : function(){
                    $(".main-panel").stop().animate({"left":"0"}, 250, function(){
                        //접근성
                        $(this).focus();
                        $(this).attr("aria-hidden", false).siblings("div").attr("aria-hidden", true);
                    });
                    $(".sub-panel.alarm-setting").stop().animate({"left":"100%"}, 250);
                }
            });
            //오픈소스 라이센스 창 열기
            $("#btn-license").on({
                click : function(){
                    $(".main-panel").stop().animate({"left":"-100%"}, 250);
                    $(".sub-panel.source-license").stop().animate({"left":"0"}, 250, function(){
                        //접근성
                        $(this).focus();
                        $(this).attr("aria-hidden", false).siblings("div").attr("aria-hidden", true);
                    });
                }
            });
            //오픈소스 라이센스 창 닫기
            $(".source-license .btn-opt-prev").on({
                click : function(){
                    $(".main-panel").stop().animate({"left":"0"}, 250, function(){
                        //접근성
                        $(this).focus();
                        $(this).attr("aria-hidden", false).siblings("div").attr("aria-hidden", true);
                    });
                    $(".sub-panel.source-license").stop().animate({"left":"100%"}, 250);
                }
            });

            $("#btn-mkt").on({
                click : function(){
                    beforeFocusEle = "#btn-mkt";
                    optModal.open("modalShopInfo", "alertdialog", "<em>쇼핑정보가 필요하신가요?</em><p>마케팅 수신동의하고 <br>다양한 이벤트 및 혜택을 받아보세요!</p>", "동의", "동의안함");
                }
            });

            $(".opt-switch input").on({
                change : function(){
                    var checked = $(this).prop("checked");
                    if(checked){
                        $(this).siblings("span").text("ON");
                    }else{
                        $(this).siblings("span").text("OFF");
                    }
                }
            });
        });
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WL297VL');</script>
    <!-- End Google Tag Manager -->
</head>
<body>
    <button type="button" class="btn-opt-login" id="btn-opt-open"><span>옵션 열기</span></button>
    <br>
    <br>
    <button type="button" class="btn-opt-login" id="btn-mkt"><span>마케팅 수신동의 모달 열기</span></button>

    <div class="lyr-opt-panel">
        <div class="main-panel" aria-hidden="true" tabindex="0">
            <div class="gap"></div>
            <div class="opt-header">
                <h1>설정</h1>
                <button type="button" class="btn-opt-close"><span>설정 닫기</span></button>
            </div>

            <div class="opt-container">
                <div class="opt-controls">
                    <h2>로그인 설정</h2>
                    <!-- 로그인 전 -->
                    <!--
                    <div>
                        <p class="txt-login-guide">로그인을 해주세요</p>
                        <button type="button" class="btn-opt-login" id="btn-opt-login"><span>로그인</span></button>
                    </div>
                    -->
                    <!-- //로그인 전 -->

                    <!-- 로그인 후 -->
                    <div>
                        <p>김엘지</p>
                        <button type="button" class="btn-opt-login" id="btn-opt-logout"><span>로그아웃</span></button>
                    </div>
                    <!-- //로그인 후 -->
                    <div>
                        <p>자동 로그인</p>
                        <div class="opt-switch">
                            <label for="autoLogin">
                                <input type="checkbox" id="autoLogin" checked>
                                <span>ON</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="opt-controls">
                    <h2>알림</h2>
                    <div>
                        <a href="#" class="link" id="btn-alarm-set" role="button">알림설정</a>
                    </div>
                </div>

                <div class="opt-controls">
                    <h2>앱 권한</h2>
                    <div>
                        <p>위치정보 이용동의</p>
                        <div class="opt-switch">
                            <label for="locInfo">
                                <input type="checkbox" id="locInfo">
                                <span>OFF</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="opt-controls">
                    <div>
                        <a href="#" class="link" id="btn-license" role="button">오픈소스 라이선스</a>
                    </div>
                </div>

                <div class="opt-controls">
                    <h2>버전정보</h2>
                    <div class="v-align">
                        <p>
                            <span>설치 버전 v_00.00</span>
                            <span>최신버전 <em>v_00.00</em></span>
                        </p>
                        <!-- 비활성화 -->
                        <button type="button" class="btn-opt-update"><span>업데이트</span></button>
                        <!-- //비활성화 -->

                        <!-- 활성화 -->
                        <!--
                        <button type="button" class="btn-opt-update on"><span>업데이트</span></button>
                        -->
                        <!-- //활성화 -->
                    </div>
                </div>
            </div>
        </div>
        <!-- //설정 메인 -->

        <div class="sub-panel alarm-setting" aria-hidden="true" tabindex="0">
            <div class="opt-header type-sub">
                <button type="button" class="btn-opt-prev"><span>이전 화면으로 가기</span></button>
                <h1>알림설정</h1>
            </div>

            <div class="opt-container">
                <div class="opt-controls">
                    <div>
                        <p>푸시 알림 받기</p>
                        <div class="opt-switch">
                            <label for="pushAlarm">
                                <input type="checkbox" id="pushAlarm" aria-controls="ctrlArea" aria-expanded="false">
                                <span>OFF</span>
                            </label>
                        </div>
                    </div>

                    <div class="ctrl-area" id="ctrlArea" aria-labelledby="pushAlarm">
                        <div>
                            <p>에티켓 시간 설정</p>
                            <div class="opt-switch">
                                <label for="timeSet">
                                    <input type="checkbox" id="timeSet">
                                    <span>OFF</span>
                                </label>
                            </div>
                        </div>
                        <div class="details">
                            <div class="time-setting" id="timeSettingCon">
                                <!-- <p>* 지정된 시간 동안 푸시 알림 거부</p> -->
                                <p class="txt-guide">지정된 시간 동안 푸시 알림 거부</p>
                                <div class="inner">
                                    <div>
                                        <label for="t-start">시작</label>
                                        <label for="t-start" class="rst-time-start" aria-curent="time">21:00</label>
                                        <input type="time" id="t-start" class="t-start" value="21:00" disabled>
                                    </div>
                                    <div>
                                        <label for="t-end">종료</label>
                                        <label for="t-end" class="rst-time-end" aria-curent="time">08:00</label>
                                        <input type="time" id="t-end" class="t-end" value="08:00" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="disabled">
                        <p>배지 알림 받기</p>
                        <div class="opt-switch">
                            <label for="badgeAlarm">
                                <input type="checkbox" id="badgeAlarm" disabled>
                                <span>OFF</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="opt-controls">
                    <div>
                        <p>마케팅 푸시 알림 받기</p>
                        <div class="opt-switch">
                            <label for="mktPushAlarm">
                                <input type="checkbox" id="mktPushAlarm">
                                <span>OFF</span>
                            </label>
                        </div>
                    </div>
                    <p class="txt-guide">광고성 알림은 에티켓 시간설정과 상관없이 <br><span>21:00~08:00</span>에는 발송되지 않습니다.</p>
                </div>
            </div>
        </div>
        <!-- //알림성정 -->

        <div class="sub-panel source-license" aria-hidden="true" tabindex="0">
            <div class="opt-header type-sub">
                <button type="button" class="btn-opt-prev"><span>이전 화면으로 가기</span></button>
                <h1>오픈소스 라이선스</h1>
            </div>
            <div class="opt-container">
                <div>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur numquam, aliquid facilis dignissimos sed obcaecati at corrupti nihil quod atque facere voluptates iusto exercitationem ex nisi? Ea architecto consectetur nulla.<br>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Sed iste excepturi nobis laudantium quidem asperiores suscipit unde, atque ipsum officiis at debitis architecto labore molestiae dolorem cumque voluptas, praesentium id.<br>
                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Eveniet sapiente dicta rerum ipsa voluptate, minima odit nulla, facere optio, neque at? Consectetur animi commodi placeat nesciunt distinctio harum magnam dolores!<br>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Ut beatae mollitia praesentium iure esse provident dolor explicabo possimus ex aperiam. Tempore, sed ratione tempora perspiciatis sint soluta molestias porro ipsa!
                </div>
            </div>
        </div>
        <!-- //오픈소스 라이선스 -->
    </div>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WL297VL" height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
</body>
</html>