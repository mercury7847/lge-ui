<!DOCTYPE html>
<html lang="ko">
    @@include('./common/head.html', {
        pageCSS: ["BMC/BMC"],
        pageJS: ["caresolution/addressManagement"]
    })
<body>
    <article id="popup" class="win-popup-wrap uiForm">
        <header class="pop-header">
            <h1 class="tit"><span>이벤트 응모 내역 조회</span></h1>
        </header>
        <section class="pop-conts event-app-form">
            <div class="table-cont">
                <p class="tb-tit">이벤트 응모 내역</p>
                <div class="tb_row tb-row-bl">
                    <table>
                        <caption>이벤트 응모 내역 모델명, 변경하기, 변경일자 안내</caption>
                        <colgroup>
                            <col style="width:33.33%">
                            <col style="width:33.33%">
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th scope="col">모델명</th>
                            <th scope="col">변경하기</th>
                            <th scope="col">변경일자</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>AS309DWA</td>
                            <td>
                                <button type="button" class="btn border size"><span>변경하기</span></button>
                            </td>
                            <td>2020.09.30</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="input-info">
                <div class="tit-wrap">
                    <!-- 210126 수정 - 타이틀 번호 삭제 -->
                    <h2 class="h2-tit">구매정보</h2>
                </div>
                <div class="form-wrap">
                    <dl class="forms">
                        <dt class="tit"><label for="modelName">모델명</label></dt>
                        <dd class="conts">
                            <div class="input-wrap">
                                <input type="text" class="disabled" id="modelName" value="" name="modelName" placeholder="모델명을 입력해 주세요." readonly>
                            </div>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit"><label for="buyDate">구매일자</label></dt>
                        <dd class="conts">
                            <span class="input-wrap">
                                <input type="text" class="disabled" id="buyDate" value="" name="buyDate" placeholder="구매일자를 입력해 주세요." readonly>
                            </span>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit"><label for="buyPlace">구매장소</label></dt>
                        <dd class="conts">
                            <div class="select-wrap">
                                <select class="ui_selectbox" id="buyPlace" title="구매장소 선택" name="buyPlace">
                                    <option value="" class="placeholder">선택</option>
                                    <option value="">베스트샵</option>
                                    <option value="">베스트샵</option>
                                </select>
                            </div>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit"><label for="branch">지점명</label></dt>
                        <dd class="conts">
                            <span class="input-wrap">
                                <input type="text" id="branch" value="운정점" name="branch" placeholder="지점명을 입력해 주세요.">
                            </span>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit"><label for="serialNum">제조번호(S/N)</label></dt>
                        <dd class="conts">
                            <div class="box">
                                <div class="input-wrap">
                                    <input type="text" id="serialNum" name="serialNum" value="" placeholder="S/N을 입력해 주세요.">
                                    <p class="link"><a href="#" data-control="modal" id="serialPopupBtn" class="btn-link">제품 제조번호 확인방법</a></p>
                                </div>
                                <div class="cell">
                                    <button type="button" class="btn" id="serialCheckBtn"><span>제조번호 확인</span></button>
                                </div>
                            </div>
                        </dd>
                    </dl>
                </div>
            </div>

            <div class="input-info">
                <div class="tit-wrap">
                    <!-- 210126 수정 - 타이틀 번호 삭제 -->
                    <h2 class="h2-tit">서비스 요청 정보</h2>
                </div>
                <div class="form-wrap">
                    <dl class="forms">
                        <dt class="tit"><label for="name" class="req">이름<span class="blind">필수입력</span></label></dt>
                        <dd class="conts">
                            <div class="input-wrap">
                                <input type="text" id="name" name="userName" data-required="true" placeholder="이름을 입력해 주세요." value="">
                            </div>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit">
                            <label for="phone" class="req">휴대폰<span class="blind">필수입력</span></label>
                        </dt>
                        <dd class="conts">
                            <div class="input-wrap">
                                <input type="number" id="phone" name="userPhone" data-required="true" placeholder="‘-’없이 번호만 입력해 주세요.">
                            </div>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit"><label for="addr" class="req">주소<span class="blind">필수입력</span></label></dt>
                        <dd class="conts">
                            <div class="address-box">
                                <div class="box">
                                    <div class="input-wrap zip-code">
                                        <input type="text" class="disabled" id="addr" name="zipCode" data-required="true" value="" placeholder="우편번호" readonly>
                                    </div>
                                    <div class="cell">
                                        <button type="button" class="btn" id="addressSearchBtn"><span>주소 찾기</span></button>
                                    </div>
                                </div>
                                <div class="input-wrap">
                                    <input type="text" class="disabled" value="" name="addressInfo" data-required="true" placeholder="주소 찾기를 선택해 주세요." readonly>
                                </div>
                            </div>
                            <div class="input-wrap">
                                <input type="text" value="" name="addressDetail" data-required="true" placeholder="상세주소를 입력해주세요.">
                            </div>
                        </dd>
                    </dl>
                    <dl class="forms">
                        <dt class="tit">
                            <label for="slt05" class="req">서비스 요청시기<span class="blind">필수입력</span></label>
                            <!-- 210126 수정 - 툴팁 삭제
                            <div class="tooltip-wrap"> !-- 활성화시 active --
                                <span class="tooltip-icon ui_tooltip-target">자세히 보기</span>
                                <span class="tooltip-box">
                                    <p>선택하신 날짜 이전에 상담사가 사전 연락을 드립니다. </p>
                                    <p>필터 교체와 토탈 케어 서비스는 전문 관리사에 의해 동시에 진행 됩니다.</p>
                                    <p>당첨 발표 이후 서비스 요청 시기 수정은 불가능 합니다.</p>
                                    <button type="button" class="btn-close"><span class="blind">닫기</span></button>
                                </span>
                            </div> -->
                        </dt>
                        <dd class="conts">
                            <!-- 210126 수정 - .col-2 클래스 삭제 -->
                            <div class="box date-select-box">
                                <div class="cell">
                                    <div class="box">
                                        <div class="select-wrap">
                                            <select class="ui_selectbox" id="slt05" title="년 선택" name="serviceYear" data-required="true">
                                                <option value="" class="placeholder">선택</option>
                                                <option value="2021">2021</option>
                                                <option value="2020">2020</option>
                                                <option value="2019">2019</option>
                                                <option value="2018">2018</option>
                                                <option value="2017">2017</option>
                                                <option value="2016">2016</option>
                                                <option value="2015">2015</option>
                                            </select>
                                        </div>
                                        <div class="text"><span>년</span></div>
                                    </div>
                                </div>
                                <div class="cell">
                                    <div class="box">
                                        <div class="select-wrap">
                                            <select class="ui_selectbox" id="slt06" title="월 선택" name="serviceMonth" data-required="true">
                                                <option value="" class="placeholder">선택</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                            </select>
                                        </div>
                                        <div class="text"><span>월</span></div>
                                    </div>
                                </div>
                            </div>
                        </dd>
                    </dl>
                    <!-- 210126 수정 - 돔 추가 -->
                    @@include('./common/modules/bullet-list.html', {
                        "topBorder" : true,
                        "bulletTxt" : [
                            "선택하신 날짜 이전에 상담사가 사전 연락을 드립니다.",
                            "필터 교체와 토탈 케어 서비스는 전문 관리사에 의해 동시에 진행 됩니다.",
                            "당첨 발표 이후 서비스 요청 시기 수정은 불가능 합니다."
                        ]
                    })
                    <!-- // 210126 수정 -->
                </div>
            </div>
        </section>
        <footer class="pop-footer center">
            <div class="btn-group">
                <button type="button" class="btn pink" id="uiSubmit"><span>저장하기</span></button>
            </div>
        </footer>
        <!-- <button type="button" class="win-btn-close"><span class="blind">닫기</span></button> -->
    </article>

    <article id="serialPopup" class="popup-wrap" data-list-url="/lg5-common/data-ajax/mypage/product/searchModelName.json">
        <!-- 210126 수정 - 전체 화면 변경 -->
        <header class="pop-header">
            <h1 class="tit"><span>모델명 확인 방법</span></h1>
        </header>
        <section class="pop-conts common-pop academy-pop no-footer"><!-- [11.27 수정] common-pop Class 추가 -->
            <p class="noti-txt">사용하시는 제품의 <em>모델명</em>과 <em>제조번호</em>를 확인해주세요.</p>
            <div class="example-list">
                <dl>
                    <dt>모델명</dt>
                    <dd>PRODUCT CODE 나 SVC CODE 또는 제품 CODE로 확인</dd>
                </dl>
                <dl>
                    <dt>제조번호</dt>
                    <dd>SERIAL NO(S/N) 또는 일련번호로 확인</dd>
                </dl>
                <dl class="sel-category">
                    <dt>카테고리 선택</dt>
                    <dd>
                        <div class="select-wrap">
                            <select class="ui_selectbox" id="select1" title="카테고리 선택">
                                <option value="" class="placeholder">TV/AV</option>
                                <option value="">카테고리</option>
                            </select>
                        </div>
                    </dd>
                    <dd>
                        <div class="select-wrap">
                            <select class="ui_selectbox" id="select2" title="세부 카테고리 선택" disabled>
                                <option value="" class="placeholder">세부 카테고리 선택</option>
                                <option value="">세부 카테고리</option>
                            </select>
                        </div>
                    </dd>
                </dl>

                <div class="example-result">
                    <p class="txt">제품 카테고리를 선택하면, 해당 제품의 모델명 확인 방법을 안내해 드립니다.</p>
                    <div class="img" aria-hidden="true">
                        <!-- 
                            제품 이미지 없을 경우
                            <img src="/lg5-common/images/img-nodata.svg" alt=""> 
                        -->
                        <img src="/lg5-common/images/dummy/@img-example.jpg" alt="">
                    </div>
                </div>

            </div>
        </section>
        <button type="button" class="btn-close ui_modal_close"><span class="blind">닫기</span></button>
    </article>
    

    <script>
        $(function () {
            
            vcui.require(['ui/validation','ui/modal', 'ui/selectbox'], function (Validation) {

                // 구매정보 입력
                var buyerInfoObj = {
                        modelName:{value:'AS309DWA'},
                        buyDate:{value:'2020.09.10'}
                }


                $('#serialNum').css('text-transform', 'uppercase');
                var checkSerialSuccess = false;    

				var validation = new Validation('.uiForm', { register : buyerInfoObj});
                
                validation.on('errors', function(e,data){
                    //console.log(data);

                }).on('success', function(data){
                    // 성공이 이벤트
                    //console.log(validation.getValues());

                }).on('nextfocus', function(e,$target){

                    if($target.attr('name') == 'addressInfo'){
                        setTimeout(function () {
                            $('#addressSearchBtn').focus();
                        }, 10);                        
                    }
                });

                // 제조번호 확인버튼 이벤트
                $('#serialCheckBtn').on('click', function(e){

                    var serialRegex = /^\d{3}[A-Za-z]{4}[\d\A-Za-z]{5,7}$/ 
                    checkSerialSuccess = serialRegex.test($('#serialNum').val());

                    if(checkSerialSuccess) {
                        lgkorUI.alert("", {title: "제조번호(S/N)가 확인되었습니다."});
                    } else {
                        lgkorUI.alert("", {title: "해당 제조번호(S/N)가 존재하지 않습니다.<br>제조번호 확인 후 다시 입력해 주세요."});
                        $('#serialNum').focus();
                    }
                });


                // 서비스 요청 정보 주소찾기
                var addressFinder = new AddressFind();

                $('#addressSearchBtn').on('click', function(e){
                    addressFinder.open(function(data){
                        $('input[name=zipCode]').val(data.zonecode);
                        $('input[name=addressInfo]').val(data.roadAddress);
                        
                        // 상세정보로 포커스 이동
                        $('input[name=addressDetail]').focus();
                    });
                });

                // 신청하기 버튼 이벤트
                $('#uiSubmit').on('click', function(){  
                    validation.validate(); 	                    
                });          
                
                

                //// 제품 제조번호 확인방법 

                var modelData = null;
                var modelListData = null;
                var $serialPopupBtn = $('#serialPopupBtn');
                var $serialPopup = $('#serialPopup');

                $serialPopupBtn.on('click', function(e){
                    e.preventDefault();
                    if(!modelData) {
                        var ajaxUrl = $serialPopup.attr('data-list-url');
                        lgkorUI.requestAjaxData(ajaxUrl, null, function(result) {

                            var selectbox = $serialPopup.find('.ui_selectbox:eq(0)');
                            var data = result.data;
                            modelData = data;
                            var arr = data instanceof Array ? data : [];
                            modelListData = vcui.array.reduce(arr, function (prev, cur) {
                                return prev.concat(cur['modelList']);
                            }, []); 

                            var newArr = [{'text':'선택'}];
                            arr.forEach(function(item, index) {
                                newArr.push({'text':item.categoryName, 'value':index});
                            });
                            selectbox.vcSelectbox('update', newArr);
                            $serialPopup.vcModal('open');

                        });


                    } else {
                        var selectbox = $serialPopup.find('.ui_selectbox:eq(0)');
                        selectbox.vcSelectbox('selectedIndex', 0, true);
                        $serialPopup.vcModal('open');
                    }

                });

                //카테고리 선택
                $serialPopup.on('change', '.ui_selectbox:eq(0)', function(e,data){
                    var index = data.selectedIndex;
                    var $selectbox = $serialPopup.find('.ui_selectbox:eq(1)');
                    if(index == 0) {
                        $selectbox.vcSelectbox('disabled', true);
                    } else {
                        $selectbox.vcSelectbox('disabled', false);
                        var mdData = modelData[index-1];
                        var arr = mdData.modelList instanceof Array ? mdData.modelList : [];
                        var newArr = [{'text':'세부 카테고리 선택', 'value':''}]
                        arr.forEach(function(item, index) {
                            newArr.push({'text':item.modelName, 'value':item.modelName});
                        });     

                        $selectbox.vcSelectbox('update', newArr);
                    }
                });

                //모델 선택
                $serialPopup.on('change', '.ui_selectbox:eq(1)', function(e,data){

                    var value = $(this).val();
                    var obj = vcui.array.filterOne(modelListData, function(item, index) {
		                return item['modelName'] === value;
		            });
                    var imageUrl = obj['imageUrl'];
                    var text, imageAlt = obj['imageAlt'];

                    if(vcui.isEmpty(imageUrl)) {
                        text = imageAlt = "제품 이미지 준비중입니다.";
                        imageUrl = "/lg5-common/images/img-nodata.svg";
                    }

                    $serialPopup.find('div.example-result p.txt').text(text);
                    $serialPopup.find('div.example-result img').attr({'src':imageUrl,'alt':imageAlt});
                });
            })
        });
    </script>
</body>
</html>